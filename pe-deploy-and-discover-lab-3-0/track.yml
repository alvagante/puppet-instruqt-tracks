slug: pe-deploy-and-discover-lab-3-0
id: trd6dwmkdt6s
type: sandbox
title: 'PE Deploy and Discover - Lab 3.0: Identify Information About Your Nodes By Using facter_task & External Facts'
teaser: Use facter_task & external facts in PE to identify information about your nodes.
description: |-
  # We're putting the finishing touches on this BETA Puppet Practice Lab — go ahead and take a peek!

  Please help us find any bugs that need to be zapped and share your feedback for improving this learning experience by clicking the **Bug Zapper** tab at the top of each challenge and completing the short survey.

  We welcome your suggestions and value your feedback. If you have additional comments or suggestions after completing this BETA Puppet Practice Lab, please [reach out to us directly](mailto:education@puppet.com).
  ___

  **What you'll learn**

  In this lab you'll learn how to use **facter_task** from within the PE console to create custom external facts, giving you a glimpse of how Puppet can be used as a customizable inventory system that provides visibility and insights on your infrastructure's nodes.

  **Prerequisites**

  None

  **Before you start**

  Keep an eye on the clock. You have 30 minutes to complete this lab. After 30 minutes, your learning environment expires and your work will not be saved. If you haven't completed the lab, you can simply restart it. Click **Start track** when you're ready to begin.
icon: https://storage.googleapis.com/instruqt-images/bz-smallicon-1.png
tags:
- deploy-and-discover
owner: puppet
developers:
- greg.larkin@puppet.com
- thomas.chisholm@puppet.com
- tara.swenson@puppet.com
- catherine.trinkwon@puppet.com
private: true
published: true
show_timer: true
challenges:
- slug: use-facter-with-an-external-script
  id: br8duqywypho
  type: challenge
  title: Use Facter with an external script
  teaser: Use Facter with an external script
  notes:
  - type: text
    contents: |-
      Facter gathers built-in (core) facts that are packaged within it. It can also gather custom or external facts by using scripts that you or a third party have written.

      In this lab, you will use the PE console to:
       * Run `facter_task` against the nodes in your environment to discover which data center each node is located in.
       * Create an external fact to mark each node with its corresponding data center.

      Click **Start** when you're ready to begin.
  assignment: |
    ## Run `facter_task` in PE to retrieve datacenter facts:

    1. On the **PE Console** tab, log in using the ID `admin` and password `puppetlabs`.

    2. In the console sidebar, navigate to the **Tasks** page, and then click **Run a task**.

    3. In the **Task** field, enter `facter_task`.

    4. In the **Parameter** field, enter `fact`. In the **Value** text box, enter `timezone`, then click **Add to task**.

    5. From the **Select targets** list, choose **Node list**.

    6. In the **Add nodes** field enter `agent`, then click **Search**.

    7. Click **Add all**, then click **Run task**.

    Result: The page will reload, displaying the timezone for the `nixagent` and `winagent` nodes.

    Next, you will install an external fact script to create a data center fact and use that script to verify Facter can retrieve the fact.

    Continue below to follow instructions for Linux, or jump ahead to [instructions for Windows](#windows).
    - - -
    <img src="https://storage.googleapis.com/instruqt-images/graphic-linux.png" a name="linux">

    ## Create an external fact:
    1. Check that the data center fact does not already exist. On the **Linux Agent** tab, run the following command — it should produce no value:
    ```
    facter datacenter
    ```
    2. Next, move the provided external fact script into place. First, navigate to your home directory:

    ```
    cd
    ```

    3. Then, create the Facter location directory and external fact script:

    ```
    mkdir -p /etc/puppetlabs/facter/facts.d
    ```

    4. Open the script using the vi editor:
    ```
    vi /etc/puppetlabs/facter/facts.d/datacenter.sh
    ```

    5. Add the following contents to the script, making sure to include the corresponding data center using the table below:
    ```
    #!/usr/bin/env bash
    echo "datacenter=<DATACENTER>"
    ```
    | Time zone | Datacenter      |
    |-----------|-----------------|
    | Eastern   | datacenter-east |
    | Pacific   | datacenter-west |

    6. Close Vi, then run the following command to make the script executable:
    ```
    chmod +x /etc/puppetlabs/facter/facts.d/datacenter.sh
    ```

    ## Verify that the fact was installed and is accessible by Facter:

    7. Run `facter datacenter` again and notice the new output - it should return `datacenter-west`.

    8. Run the Puppet agent to send facts to the Puppet server:
    ```
    puppet agent -t
    ```

    9. On the **PE Console** tab, navigate to **Nodes** and click on the `nixagent` node. On the **Facts** tab, scroll down to view the `datacenter` fact displayed in the list.

    **Congratulations!** You installed an external fact script to create a data center fact, and then verified that Facter was able to retrieve the data in the fact (location: datacenter-west).

    **Find bugs or have feedback? Click the **Bug Zapper** tab near the top of the page and let us know!**

    To close this lab, click **Next**.

    - - -
    <img src="https://storage.googleapis.com/instruqt-images/graphic-windows.png" a name="windows">

    ## Create an external fact:
    1. Check that the data center fact does not already exist. On the **Windows Agent** tab, open a Powershell window and run the following command — it should produce no value:
    ```
    facter datacenter
    ```
    2. Next, move the provided external fact script into place by creating the following file:
    ```
    notepad C:\ProgramData\PuppetLabs\facter\facts.d\datacenter.ps1
    ```

    3. Add the following contents to the file, making sure to include the corresponding data center using the table below, then save the file and exit:
    ```
    write-host "datacenter=<DATACENTER>"
    ```

    | Time zone | Datacenter      |
    |-----------|-----------------|
    | Eastern   | datacenter-east |
    | Pacific   | datacenter-west |

    ## Verify that the fact was installed and is accessible by Facter:
    4. Run `facter datacenter` again and notice the new output - it should return `datacenter-east`.

    5. Run the Puppet agent to send facts to the Puppet server:
    ```
    puppet agent -t
    ```

    6. On the **PE Console** tab, navigate to **Nodes** and click on the `winagent` node. On the **Facts** tab, scroll down to view the `datacenter` fact displayed in the list.

    **Congratulations!** You installed an external fact script to create a data center fact, and then verified that facter was able to retrieve the data in the fact (location: datacenter-east).

    **Find bugs or have feedback? Click the **Bug Zapper** tab near the top of the page and let us know!**

    To close this lab, click **Next**.
  tabs:
  - title: PE Console
    type: service
    hostname: puppet
    port: 443
  - title: Primary Server
    type: terminal
    hostname: puppet
  - title: Linux Agent
    type: terminal
    hostname: nixagent
  - title: Windows Agent
    type: service
    hostname: guac
    path: /#/client/c/winagent?username=instruqt&password=Passw0rd!
    port: 8080
  - title: "Bug Zapper \U0001F99F⚡"
    type: website
    hostname: guac
    url: https://docs.google.com/forms/d/e/1FAIpQLSfeCPR2SFCb_xCGvz-8gcXk5bncpBdFkXUovtzR0Yjfil1cAw/viewform?embedded=true
  difficulty: basic
  timelimit: 3600
checksum: "2990014652507584472"
